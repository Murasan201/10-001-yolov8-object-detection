# CLAUDE.md - YOLOv8物体検出アプリ開発ルール

## プロジェクト概要
- **プロジェクト名**: YOLO物体検出アプリ
- **文書番号**: 10-001
- **リポジトリ**: https://github.com/Murasan201/10-001-yolov8-object-detection
- **目的**: Raspberry Pi 5上でYOLOv8を用いたリアルタイム物体検出を実現
- **書籍掲載**: 本プロジェクトは書籍原稿「chapter10-1.md」に掲載されるサンプルプログラムです
  - 書籍タイトル: 機械学習モデルYOLOって何？準備と設定
  - 対象読者: プログラミング初心者、Raspberry Pi入門者、AI学習者
  - 原稿パス: `/home/win/work/writing/kodansya/output/chapter10-1.md`

## 開発ルール

### 1. コーディング規約
- **Python バージョン**: Python 3.9以上
- **コーディングスタイル**: PEP8準拠
- **命名規則**:
  - 関数名・変数名: スネークケース (`detect_objects`, `frame_count`)
  - クラス名: パスカルケース (`ObjectDetector`, `VideoCapture`)
  - 定数: 大文字スネークケース (`DEFAULT_CONF_THRESHOLD`, `MAX_FPS`)
- **インデント**: スペース4つ
- **文字列**: シングルクォート優先（docstringは三重ダブルクォート）
- **コメント**: 日本語可（初心者向けのため）、複雑なロジックには必ず説明を付ける

### 2. 設計原則
- **単一ファイル完結**: メイン機能は1つのPythonスクリプトで実装
- **モジュール性**: 機能ごとに関数・クラスを適切に分割
- **拡張性**: モデルやカメラソースの切り替えが容易な設計
- **エラーハンドリング**: 初心者でも理解できる明確なエラーメッセージ
- **リソース管理**: カメラ、ウィンドウなどのリソースは必ずクリーンアップ

### 3. 必須実装機能
1. **コマンドライン引数処理**
   - `--model`: YOLOv8モデルファイルパス
   - `--source`: カメラデバイス番号またはビデオファイル
   - `--conf`: 信頼度閾値（デフォルト: 0.25）
   - `--duration`: 実行時間（秒）（オプション）

2. **物体検出パイプライン**
   - モデル読み込み
   - ビデオキャプチャ初期化
   - フレームごとの推論実行
   - バウンディングボックス描画
   - リアルタイム表示

3. **終了処理**
   - `q`キー押下での終了
   - 指定時間到達での自動終了
   - リソース解放（カメラ、ウィンドウ）

### 4. 依存ライブラリ
- **必須**:
  - `torch`: PyTorch推論実行
  - `ultralytics`: YOLOv8実装
  - `opencv-python`: 映像処理と表示
  - `numpy`: 配列操作

- **requirements.txt**: プロジェクトルートに配置し、バージョン固定

### 5. ディレクトリ構造
```
10-001-yolov8-object-detection/
├── CLAUDE.md                    # このファイル
├── LICENSE
├── README.md                    # セットアップ手順・使用方法
├── 10-001_YOLO物体検出アプリ_要件定義書.md
├── requirements.txt             # Python依存パッケージ
├── detect.py                    # メインスクリプト
├── models/                      # YOLOモデル格納ディレクトリ
│   └── yolov8n.pt              # サンプルモデル
├── test_data/                   # テスト用画像・動画
│   ├── sample_image.jpg
│   └── sample_video.mp4
└── docs/                        # 追加ドキュメント
    └── setup_guide.md
```

### 6. テスト方針
- **推論テスト**: サンプル画像で期待クラスが検出されることを確認
- **性能テスト**: FPS測定、メモリ使用量確認
- **入力テスト**: 無効なソース・モデルパス指定時のエラーハンドリング
- **終了テスト**: 正常終了とリソース解放の確認

### 7. ドキュメント要件
- **README.md**:
  - セットアップ手順（環境構築、依存インストール）
  - 使用方法（コマンド例）
  - トラブルシューティング
  - ライセンス情報

- **コード内ドキュメント**:
  - 全ての関数にdocstringを記述
  - 複雑な処理には詳細なコメント
  - 初心者が理解できる説明を心がける

### 8. パフォーマンス要件
- **Raspberry Pi 5での動作**:
  - 最低FPS: 5以上（YOLO nano modelの場合）
  - メモリ使用量: 2GB以下
  - 起動時間: 10秒以内

### 9. Git運用ルール
- **ブランチ戦略**:
  - `main`: 安定版
  - `develop`: 開発中
  - `feature/*`: 機能追加
  - `fix/*`: バグ修正

- **コミットメッセージ**: 日本語可、プレフィックス使用
  - `feat:` 新機能
  - `fix:` バグ修正
  - `docs:` ドキュメント
  - `refactor:` リファクタリング
  - `test:` テスト追加

### 10. セキュリティ・品質
- **入力検証**: 全てのユーザー入力を検証
- **例外処理**: 予期しないエラーを適切にキャッチ
- **ログ出力**: デバッグ用の適切なログレベル設定
- **依存関係**: 脆弱性のない最新安定版を使用

### 11. 対象利用者への配慮
- **初心者フレンドリー**:
  - 分かりやすいエラーメッセージ
  - デフォルト値の適切な設定
  - 詳細なREADMEとコメント
  - サンプルコマンドの提供
- **書籍読者への配慮**:
  - 書籍の説明と整合性のあるコード
  - 段階的に理解できる構造
  - 教育的なコメント（学習の助けになる説明）
  - 書籍で紹介されるコンセプトの実装例

### 12. 禁止事項
- 複雑な設計パターンの過剰使用
- 不必要な外部依存の追加
- ハードコードされた設定値（環境依存値は引数化）
- 未処理の例外の放置

## 開発フロー
1. 要件定義書の確認
2. 書籍原稿（chapter10-1.md）との整合性確認
3. 設計・実装計画の作成
4. 実装（テスト駆動開発推奨）
5. 単体テスト実施
6. Raspberry Pi実機テスト
7. 書籍の説明とコードの整合性チェック
8. ドキュメント更新
9. コードレビュー
10. mainブランチへのマージ

## 書籍掲載に関する特別ルール
1. **コードの教育的価値**
   - すべてのコードは教育目的を最優先
   - 複雑な実装よりも理解しやすい実装を選択
   - 各ステップの意図が明確に分かるコメントを記述

2. **書籍との同期**
   - 書籍で説明されている概念を正確に実装
   - 書籍のサンプルコードと実装の一貫性を保つ
   - 変数名、関数名は書籍で使用されているものと統一

3. **動作確認の重要性**
   - 書籍読者が実際に動かせることを最優先
   - エラーハンドリングは初心者が理解できる形で実装
   - 動作環境（Raspberry Pi 4/5）での確実な動作保証

4. **コメントとドキュメント**
   - 書籍を読んだ読者が理解できるレベルの説明
   - なぜそのコードが必要なのかを説明
   - 技術的な背景や選択理由を明記

## 参考情報
- [YOLOv8公式ドキュメント](https://docs.ultralytics.com/)
- [OpenCV-Python チュートリアル](https://docs.opencv.org/4.x/d6/d00/tutorial_py_root.html)
- [Raspberry Pi カメラ設定](https://www.raspberrypi.com/documentation/accessories/camera.html)

---
**最終更新**: 2025-10-23
**バージョン**: 1.0
